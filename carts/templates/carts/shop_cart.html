{% extends "carts/base.html" %}
{% load static %}
{% load humanize %}
{% block title %}<title>Cart ({{cart_items|length}})</title>{% endblock %}
{% block content %}
  <main>
    <div class="mb-4 pb-4"></div>

    {% if cart_items %}
    <!-- If cart has products -->
    <section class="shop-checkout container">
      <h2 class="page-title">Cart</h2>
      <div class="checkout-steps">
        <a href="{% url 'carts_urls:view_cart_page' %}" class="checkout-steps__item active">
          <span class="checkout-steps__item-number">01</span>
          <span class="checkout-steps__item-title">
            <span>Shopping Bag</span>
            <em>Manage Your Items List</em>
          </span>
        </a>
        <a class="checkout-steps__item">
          <span class="checkout-steps__item-number">02</span>
          <span class="checkout-steps__item-title">
            <span>Shipping and Checkout</span>
            <em>Checkout Your Items List</em>
          </span>
        </a>
        <a class="checkout-steps__item">
          <span class="checkout-steps__item-number">03</span>
          <span class="checkout-steps__item-title">
            <span>Confirmation</span>
            <em>Review And Submit Your Order</em>
          </span>
        </a>
      </div>

      <div class="shopping-cart">
        <div class="cart-table__wrapper">
          <table class="cart-table">
            <thead>
              <tr>
                <th>Product</th>
                <th></th>
                <th>Price</th>
                <th>Quantity</th>
                <th>Subtotal</th>
                <th></th>
              </tr>
            </thead>
            <tbody>
              {% for cart_item in cart_items %}
                <tr>
                  <td>
                    <div class="shopping-cart__product-item">
                      <a href="{{cart_item.product.get_url}}">
                        <img loading="lazy" src="{{cart_item.product.product_image.url}}" width="120" height="120" alt="">
                      </a>
                    </div>
                  </td>
                  <td>
                    <div class="shopping-cart__product-item__detail">
                      <h4><a href="{{cart_item.product.get_url}}">{{cart_item.product.product_name}}</a></h4>
                      <ul class="shopping-cart__product-item__options">
                        {% if cart_item.size %}
                          <li>Size: {{ cart_item.size|upper }}</li>
                        {% endif %}
                        
                      </ul>
                    </div>
                  </td>
                  <td>
                    <span class="shopping-cart__product-price">₹{{cart_item.product.price}}</span>
                  </td>
                  <td>
        <div class="qty-control position-relative">
          <input type="number" value="{{ cart_item.quantity }}" min="1" max="{{ cart_item.product.stock }}" class="qty-control__number text-center" readonly>

          <!-- decrease -->
          <a href="{% url 'carts_urls:remove_cart_page' cart_item.id %}" class="qty-control__reduce">-</a>

          <!-- increase -->
          {% if cart_item.quantity < cart_item.product.stock %}
            <form action="{% url 'carts_urls:add_cart_page' cart_item.product.id %}" method="POST" style="display:inline;">
              {% csrf_token %}
              <input type="hidden" name="size" value="{{ cart_item.size }}">
              <input type="hidden" name="quantity" value="1">
              <button type="submit" class="qty-control__increase" style="border: 0; background: transparent;">+</button>
            </form>
          {% else %}
            <button class="qty-control__increase btn btn-light" disabled title="No more stock">+</button>
          {% endif %}
        </div>
      </td>
                  <td>
                    <span class="shopping-cart__subtotal">₹{{ cart_item.sub_total|floatformat:2|intcomma }}</span>
                  </td>
                  <td>
                    <a href="{% url 'carts_urls:remove_cart_item_page' cart_item.id %}" class="cart_item_removers">
                      <svg width="10" height="10" viewBox="0 0 10 10" fill="#767676" xmlns="http://www.w3.org/2000/svg">
                        <path d="M0.259435 8.85506L9.11449 0L10 0.885506L1.14494 9.74056L0.259435 8.85506Z" />
                        <path d="M0.885506 0.0889838L9.74057 8.94404L8.85506 9.82955L0 0.97449L0.885506 0.0889838Z" />
                      </svg>
                    </a>
                  </td>
                </tr>
              {% endfor %}
              
            </tbody>
          </table>

          <div class="cart-table-footer">
            <form action="#" class="position-relative bg-body">
              <input class="form-control" type="text" name="coupon_code" placeholder="Coupon Code">
              <input class="btn-link fw-medium position-absolute top-0 end-0 h-100 px-4" type="submit" value="APPLY COUPON">
            </form>
            <button class="btn btn-light">UPDATE CART</button>
          </div>
        </div>

        <div class="shopping-cart__totals-wrapper">
          <div class="sticky-content">
            <div class="shopping-cart__totals">
              <h3>Cart Totals</h3>
              <table class="cart-totals">
                <tbody>
                  <tr>
                    <th>Total Price</th>
                    <td>₹{{total|floatformat:2|intcomma}}</td>
                  </tr>
                  <tr>
                    <th>CGST & SGST <br><span style="font-size: 12px; font-style: italic; opacity: 0.7;">(included)</span></th>
                    <td>₹{{tax|floatformat:2|intcomma}}</td>
                  </tr>
                  <tr>
                    <th>Platform Fee</th>
                    <td>₹{{platform_fee}}</td>
                  </tr>
                  <tr>
                    <th>Total</th>
                    <td>₹{{grand_total|floatformat:2|intcomma}}</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="mobile_fixed-btn_wrapper">
              <div class="button-wrapper container">
                <a href="{% url "carts_urls:checkout_page" %}" class="btn btn-primary btn-checkout" style="display: flex; align-items: center; justify-content: center;">PROCEED TO CHECKOUT</a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
    {% else %}
    <!-- If cart is empty -->
    <section class="shop-checkout container text-center py-5">
      <h2>Your cart is empty</h2>
      <p class="text-muted">Add some products to continue shopping.</p>
      <a href="{% url "products:products_page" %}" class="btn btn-primary mt-3">Go to Shop</a>
    </section>
    {% endif %}

  </main>

  <div class="mb-5 pb-xl-5"></div>
{% endblock %}
